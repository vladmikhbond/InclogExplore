# Последовательность состояний текста

## Постановка задачи

Если в процессе создание текста фиксировать его промежуточные состояния, можно получить информацию об обстоятельствах создания этого текста.
Например, на экзамене студенту предлагают решить задачу на программирование, т.е. написать какой-то программный код. Тогда рассматривая ход решения задачи можно судить, был ли код написан самостоятельно или заимствован.

## Описание алгоритма

Состоянием будем называть текущую версию создаваемого текста, вообще говоря, строку.
Состояния фиксируются через небольшие равные промежутки времени, например 5 секунд.
Последовательность зафиксированных состояний будем называть журналом.

Чтобы уменьшить количество сохраняемых данных, хранятся не сами состояния, а "разности" между двумя соседними состояниями.

Разность между состояниями A и B (обозначим ее B-A) определяется следующим образом.
Для строк A и B находится максимальная общая подстрока M. Поиск максимальной общей подстроки выполняется динамическим вариантом алгоритма LCS (Lagest Common String) [3].

Найденная подстрока M разбивает строки A и B на три области: (Al, M, Ar) и (Bl, M, Br) соответственно.
Al - часть строки A слева от M,  Ar - часть строки A справа от M,
Bl - часть строки B слева от M,  Br - часть строки B справа от M.
B-A определяется рекурсивно как четверка (pos, len, Bl-Al, Br-Ar),
где pos - место вхождения общей подстроки M в строку A,
len - длина подстроки M.
Bl-Al - левая разность, Br-Ar - правая разность.

Базу рекурсии составляет случай, когда длина строка M незначительна, а точнее, меньше минимально допустимого размера d.
В этом случае В-A = В.
Хотя для восстановления последовательности состояний нет необходимости сохранять A в составе разности, в интересах анализа мы не отбрасываем A и сохраняем пару, т.е. В-A = (A, B).
Наконец, если A = B, т.е. между двумя засечками времени состояние не изменилось, B-A = (), сохраняем пустой кортеж.

## Оценка объема носителя

Априорная оценка возможна, если сделать некоторые допущения.
Пусть общий объем добавленного кода - V, общий объем удаленного кода - U,
количество засечек времени - t.  
c - средний расход памяти на оформление одной разности.

Тогда объем носителя, необходимый для сохранения журнала,
    T1 = V + U + t * a

Если бы журнал сохранялся, не прибегая к вычислению разностей, объем носителя был бы
    T2 = (V - U)/2 * t

Для иллюстрации подставим в формулы характерные значения переменных
V = 300, U = 100, t = 200 (15-20 мин), a = 10.
Получим T1 = 2400, T2 = 20000, что вполне оправдывает усилия по экономии.

## Настройка алгоритма

Алгоритм имеет параметр - d - наименьший размер общей части. Если общая часть маленькая, затраты на оформление разности превысят экономию от не дублирования данных. Значение параметра d определим экспериментально.

## ЛИТЕРАТУРА

[2]Бондарев В.М., Черепанова Ю.Ю. Сетевая среда для подготовки и чтения лекций. Збірник наукових праць Харківського національного університету Повітряних Сил. 4(53). 2017. С. 171-177.  http://www.hups.mil.gov.ua/periodic-app/article/17810
[3]Т. Х. Кормен, Ч.И. Лейзерсон, Р. Л. Ривест, К. Штайн. Алгоритмы: построение и анализ, 3-е издание = Introduction to Algorithms, Third Edition. — М.: «Вильямс», 2013. — 1328 с. — ISBN 978-5-8459-1794-2.
